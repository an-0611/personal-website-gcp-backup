import{d as G,r as i,g as V,e as O,c,b as e,h as l,w as v,v as w,n as S,i as X,t as m,u as y,F as E,j as H,k as j,o as r,p as J,a as K,_ as P}from"./index-2c6600ab.js";const d=_=>(J("data-v-8812419b"),_=_(),K(),_),Q={id:"ig-lottery"},W={id:"ig-container",class:"shadow-1"},Y=d(()=>e("div",{class:"hint"}," ＊帳號及貼文需公開才可查詢留言 ＊每次查詢完成快取時間為 10 分鐘 ",-1)),Z=d(()=>e("div",{class:"condition-text"},"設定抽獎條件:",-1)),ee=d(()=>e("label",{for:"limitText"},"2. 留言包含以下文字：",-1)),te={class:"checkbox"},se={class:"checkbox__1"},ne=d(()=>e("label",{for:"checkbox-1"},[e("i",{class:"material-icons"},"✓")],-1)),ae={class:"draw-times"},oe={id:"comment-info"},ie={id:"total-comment-number"},le={id:"eligible-number"},de={id:"avator-container",class:"shadow-1"},ce={key:0,id:"avator-container-content"},re=d(()=>e("div",{class:"avator"},"😀",-1)),ue={class:"name-and-msg-box"},ve={class:"name"},me=["innerHTML"],_e=d(()=>e("div",{class:"circle"},null,-1)),he=[_e],pe={id:"draw-info"},ge={class:"result"},fe={id:"win-number"},be=d(()=>e("br",null,null,-1)),xe={id:"result-container",class:"shadow-1"},we={key:0,id:"result-container-content"},ye=d(()=>e("div",{class:"avator"},"🥳",-1)),ke={class:"name-and-msg-box"},Te={class:"name"},Ce=["innerHTML"],Le=d(()=>e("div",{class:"circle"},null,-1)),Me=[Le],Ne=G({__name:"ig-lottery",setup(_){const u=i(!1),k=i(!1),T=i(!1),C=i(0),h=i(0),p=i(0),L=i(""),M=i(1),g=i(0),f=i(""),N=i(!1);let b=V([]),a=V([]),x=V([]);function A(n,s,t){t=Math.min(t,s);const o=new Set;for(;o.size<t;)o.add(Math.floor(Math.random()*(s-n+1))+n-1);return Array.from(o)}function B(n){const s=n.match(/\/p\/([\w-]+)\/?(?:\/comments)?\/?$/);return s?s[1].toString():""}function F(){b.splice(0),a.splice(0),C.value=0,h.value=0,p.value=0}function U(){x.splice(0)}function q(){u.value||(p.value=0,k.value=!0,setTimeout(()=>{const n=Number(M.value),s=a.length,o=A(1,s,n);for(let I=0;I<o.length;I++){const $=o[I];x.push(a[$])}k.value=!1,p.value=o.length},1500))}const z=()=>{var n=L.value.trim(),s=B(n);if(!u.value){if(!n||!s){alert("請填入有效網址");return}F(),U();try{u.value=!0,fetch(`https://hean.tw/api?post_url=${n}`).then(t=>{if(t.status===200)return t.json();T.value=!0,setTimeout(()=>{T.value=!1},5e3)}).then(t=>{u.value=!1,C.value=t.data.length,b=a=t.data,h.value=t.data.length}).catch(t=>console.error(t))}catch{u.value=!1}}},R=()=>{U(),setTimeout(()=>{q()},500)},D=()=>{b.length!==0&&setTimeout(()=>{if(a=b.slice(),Number(g.value)&&(a=a.filter(n=>n.shareNum>=g.value)),f.value.trim()&&(a=a.filter(n=>n.msg.includes(f.value))),!N.value){const n=a.reduce((s,t)=>((s[t.name]===void 0||t.createAt>s[t.name].createAt)&&(s[t.name]=t),s),{});a=Object.values(n)}h.value=a.length},500)};return O(()=>{window.gtag("ig-lottery","G-E06X06SF0E",{"view-ig-lottery":!0})}),(n,s)=>(r(),c("div",Q,[e("div",W,[e("div",null,[l(" 貼文網站： "),v(e("input",{type:"text",id:"post-url-input","onUpdate:modelValue":s[0]||(s[0]=t=>L.value=t),placeholder:"e.g. https://www.instagram.com/p/xxxxxxxxxxx/"},null,512),[[w,L.value]]),e("div",{id:"get-comments-btn",class:"btn shadow-1",onClick:z}," 點擊載入貼文留言 ")]),Y,e("div",{id:"error-hint",class:S({show:T.value})}," 伺服器忙碌中，請稍後再試 ",2),e("div",null,[Z,e("div",null,[l(" 1. 留言標記人數需達： "),v(e("input",{type:"number",id:"share-limit",name:"quantity","onUpdate:modelValue":s[1]||(s[1]=t=>g.value=t),min:"0",onChange:D},null,544),[[w,g.value]])]),e("div",null,[ee,v(e("input",{type:"text",id:"limitText",name:"limitText","onUpdate:modelValue":s[2]||(s[2]=t=>f.value=t),onInput:D,placeholder:"輸入文字"},null,544),[[w,f.value]])]),e("div",null,[l(" 3. 過濾重複留言(一人僅可使用一則最新有效留言) "),e("div",te,[e("div",se,[v(e("input",{id:"checkbox-1",type:"checkbox","onUpdate:modelValue":s[3]||(s[3]=t=>N.value=t),onChange:D},null,544),[[X,N.value]]),ne])])])]),e("div",ae,[l(" 4. 本次抽出人數: "),v(e("input",{type:"number",name:"quantity","onUpdate:modelValue":s[4]||(s[4]=t=>M.value=t),min:"1"},null,512),[[w,M.value]])]),e("div",oe,[e("div",null,[l(" 總留言人數: "),e("span",ie,m(C.value),1),l(" 人 ")]),e("div",null,[l(" 以下為符合抽獎用戶資訊 共 "),e("span",le,m(h.value),1),l(" 人 ")]),e("div",de,[y(a).length>0?(r(),c("div",ce,[(r(!0),c(E,null,H(y(a),(t,o)=>(r(),c("div",{class:"avator-box",key:o},[re,e("div",ue,[e("div",ve,m(t.name),1),e("div",{class:"msg",innerHTML:t.msg},null,8,me)])]))),128))])):j("",!0),e("section",{id:"loading-1",class:S(["loading-container",{show:u.value}])},he,2)])]),e("div",pe,[e("div",{id:"draw-btn",class:"btn shadow-1",onClick:R}," 開始抽獎 "),e("div",ge,[l(" 得獎名單：共 "),e("span",fe,m(p.value),1),l(" 人 "),be,e("div",xe,[y(x).length>0?(r(),c("div",we,[(r(!0),c(E,null,H(y(x),(t,o)=>(r(),c("div",{class:"avator-box",key:o},[ye,e("div",ke,[e("div",Te,m(t.name),1),e("div",{class:"msg",innerHTML:t.msg},null,8,Ce)])]))),128))])):j("",!0),e("section",{id:"loading-2",class:S(["loading-container",{show:k.value}])},Me,2)])])])])]))}});const Ie=P(Ne,[["__scopeId","data-v-8812419b"]]);export{Ie as default};
